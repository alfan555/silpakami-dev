@extends('layouts.layoutAdmin')
@section('menu')
<?php $item = 'layananPentest'; ?>
@endsection
@section('css')
<!-- Datatables -->
<link href="{{asset('hud/plugins/datatables.net-bs5/css/dataTables.bootstrap5.min.css')}}" rel="stylesheet" />
<link href="{{asset('hud/plugins/datatables.net-buttons-bs5/css/buttons.bootstrap5.min.css')}}" rel="stylesheet" />
<link href="{{asset('hud/plugins/datatables.net-responsive-bs5/css/responsive.bootstrap5.min.css')}}"
  rel="stylesheet" />
<link href="{{asset('hud/plugins/bootstrap-table/dist/bootstrap-table.min.css')}}" rel="stylesheet" />

<link href="{{asset('hud/plugins/bootstrap-daterangepicker/daterangepicker.css')}}" rel="stylesheet" />


{{-- Select2--}}
<!-- <link href="{{asset('hud/css/select2.css')}}" rel="stylesheet"/> -->
<link href="{{asset('hud/css/select2.min.css')}}" rel="stylesheet" />
<!--file input-->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.0.1/css/fileinput.min.css" media="all"
  rel="stylesheet" type="text/css" />

@endsection

@section('content')

<div id="content" class="app-content">

  <div class="container">

    <div class="row justify-content-center">

      <div class="col-xl-12">

        <div class="row">

          @if(session('error'))
          <div class="alert alert-danger alert-dismissable fade show p-3">
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            <strong>{{session('error')}}</strong>
          </div>
          @endif
          @if(session('success'))
          <div class="alert alert-success alert-dismissable fade show p-3">
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            <strong>{{session('success')}}</strong>
          </div>
          @endif

          @if (count($errors) > 0)
          <div class="alert alert-success alert-dismissable fade show p-3">
            <button type="button" class="close pull-right" data-bs-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            <p>Perhatian!</p>
            <ul>
              @foreach ($errors->all() as $error)
              <li>{{$error}}</li>
              @endforeach
            </ul>
          </div>
          @endif


          <div class="col-xl-12">
            <h3 class="page-header">
              Pengajuan Layanan Pentest <small>per SKPD</small></h3>
            <hr class="mb-4" />

            <div id="datatable" class="mb-5">
              <div class="card">
                <div class="card-body">
                  <table id="members-table" class="table table-responsive">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Nama</th>
                        <th>Instansi</th>
                        <th>Tanggal Pengajuan</th>
                        <th>Dokumen</th>
                        <th>Status</th>
                        <th>Estimasi</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                  </table>
                </div>
                <div class="card-arrow">
                  <div class="card-arrow-top-left"></div>
                  <div class="card-arrow-top-right"></div>
                  <div class="card-arrow-bottom-left"></div>
                  <div class="card-arrow-bottom-right"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


{{-- modal detail --}}
<div id="detail" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form class="form-horizontal form-label-left">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabel">Pengajuan Permohonan Pentest</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3 row">
            <label class="control-label col-md-3" for="last-name">Nama Aplikasi <span class="required">*</span>
            </label>
            <div class="col-md-9">
              <input type="text" id="nama_aplikasi" class="form-control col-md-7 col-xs-12" readonly>
            </div>
          </div>
          <div class="mb-3 row">
            <label class="control-label col-md-3" for="last-name">Tipe Aplikasi <span class="required">*</span>
            </label>
            <div class="col-md-9">
              <select style="background-color: #202a35;" class="form-control" id="tipe_aplikasi" disabled>
                <option value="1">Web</option>
                <option value="2">Mobile</option>
              </select>
            </div>
          </div>
          <div class="mb-3 row">
            <label class="control-label col-md-3" for="last-name">Url<span class="required">*</span>
            </label>
            <div class="col-md-9">
              <input type="text" id="url" readonly class="form-control col-md-7 col-xs-12">
            </div>
          </div>
          <div class="mb-3 row">
            <label class="control-label col-md-3" for="last-name">Deskripsi Aplikasi <span class="required">*</span>
            </label>
            <div class="col-md-9">
              <textarea readonly class="form-control" id="deskripsi" data-parsley-trigger="keyup"
                data-parsley-minlength="3" data-parsley-maxlength="100"
                data-parsley-minlength-message="Come on! You need to enter at least a 5 caracters long comment.."
                data-parsley-validation-threshold="10"></textarea>
            </div>
          </div>
          <div class="mb-3 row">
            <label class="control-label col-md-3" for="last-name">Penanggung Jawab Aplikasi<span
                class="required">*</span>
            </label>
            <div class="col-md-9">
              <input type="text" id="penanggung_jawab" readonly class="form-control col-md-7 col-xs-12">
            </div>
          </div>
          <div class="mb-3 row">
            <label class="control-label col-md-3" for="last-name">No Kontak Penanggung Jawab Aplikasi<span
                class="required">*</span>
            </label>
            <div class="col-md-9">
              <input type="text" id="no_kontak" readonly class="form-control col-md-7 col-xs-12">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-bs-dismiss="modal">Keluar</button>
        </div>
      </form>
    </div>
  </div>
</div>

{{-- modal approve --}}
<div class="modal fade bs-example-modal-lg" id="aproved" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="myModalLabel">Ijinkan Permohonan</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3 row">
          Anda Yakin Ingin Mengijinkan Permohonan ?
        </div>
        <form class="form-horizontal form-label-left" action="{{route('pentestaprove')}}" method="POST">
          {{ csrf_field() }}
          <input type="hidden" id="idaprove" name="idaprove">
          <div class="mb-3 row">
            <label class="control-label col-md-4" for="last-name">Tanggal Estimasi Pentest <span
                class="required">*</span></label>
            <div class="col-md-8">
              <div class="input-group" id="default-daterange">
                <input type="text" name="tgl" class="form-control" required/>
                <label class="input-group-text"><i class="fa fa-calendar"></i></label>
              </div>
            </div>
          </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-bs-dismiss="modal">Tidak</button>
        <button type="submit" class="btn btn-danger">Ya</button>
        </form>
      </div>

    </div>
  </div>
</div>

@endsection

@section('script')
<!-- <script src="{{asset('hud/plugins/highlight.js/highlight.min.js')}}" ></script> -->
<!-- <script src="{{asset('hud/js/demo/highlightjs.demo.js')}}" ></script> -->
<script src="{{asset('hud/plugins/datatables.net/js/jquery.dataTables.min.js')}}"></script>
<script src="{{asset('hud/plugins/datatables.net-bs5/js/dataTables.bootstrap5.min.js')}}"></script>
<script src="{{asset('hud/plugins/datatables.net-buttons/js/dataTables.buttons.min.js')}}"></script>
<script src="{{asset('hud/plugins/datatables.net-buttons/js/buttons.colVis.min.js')}}"></script>
<script src="{{asset('hud/plugins/datatables.net-buttons/js/buttons.flash.min.js')}}"></script>
<script src="{{asset('hud/plugins/datatables.net-buttons/js/buttons.html5.min.js')}}"></script>
<script src="{{asset('hud/plugins/datatables.net-buttons/js/buttons.print.min.js')}}"></script>
<script src="{{asset('hud/plugins/datatables.net-buttons-bs5/js/buttons.bootstrap5.min.js')}}"></script>
<script src="{{asset('hud/plugins/datatables.net-responsive/js/dataTables.responsive.min.js')}}"></script>
<script src="{{asset('hud/plugins/datatables.net-responsive-bs5/js/responsive.bootstrap5.min.js')}}"></script>
<script src="{{asset('hud/plugins/bootstrap-table/dist/bootstrap-table.min.js')}}"></script>

<script src="{{asset('hud/plugins/moment/min/moment.min.js')}}"></script>
<script src="{{asset('hud/plugins/bootstrap-daterangepicker/daterangepicker.js')}}"></script>

<script src="{{asset('hud/js/select2.min.js')}}"></script>

<script>

  $('#default-daterange').daterangepicker({
    opens: 'right',
    locale: {
      format: 'YYYY-MM-DD'
    },
    separator: ' to ',
    startDate: moment(),
    endDate: moment(),
  },
    function (start, end) {
      $('#default-daterange input').val(start.format('YYYY-MM-DD') + ' - ' + end.format('YYYY-MM-DD'));
    }
  );

  $(document).on('click', '#bcancel', function () {
    var id = $(this).data('id');
    $('#idcancel').val(id);
  });

  $('#members-table').DataTable({
    destroy: true,
    processing: true,
    serverSide: true,
    method: 'GET',
    ajax: '{{URL::to("/admin/layananpentest/getdata")}}',
    columns: [
      { data: 'DT_RowIndex', name: 'DT_RowIndex', orderable: false, searchable: false },
      { data: 'nama', name: 'users.nama' },
      { data: 'nama_ins', name: 'instansis.nama_ins' },
      { data: 'created_at', name: 'pentests.created_at' },
      {
        data: 'path', name: 'path', render: function (data, type, row) {
          return "<a href=" + row.path + ">download</a>"
        }
      },
      { data: 'status', name: 'status', orderable: false, searchable: false },
      { data: 'estimasi', name: 'estimasi'
     },
      { data: 'action', name: 'action', orderable: false, searchable: false }
    ]
  });

  $(document).on('click', '#bdetail', function () {
    var nama_aplikasi = $(this).data('nama_aplikasi');
    var tipe_aplikasi = $(this).data('tipe_aplikasi');
    var url = $(this).data('url');
    var deskripsi = $(this).data('deskripsi');
    var penanggung_jawab = $(this).data('penanggung_jawab');
    var no_kontak = $(this).data('no_kontak');

    $('#nama_aplikasi').val(nama_aplikasi);
    $('#tipe_aplikasi').val(tipe_aplikasi).change();
    $('#url').val(url);
    $('#deskripsi').val(deskripsi);
    $('#penanggung_jawab').val(penanggung_jawab);
    $('#no_kontak').val(no_kontak);

  });

  $(document).on('click', '#baproved', function () {
    var id = $(this).data('id');
    $('#idaprove').val(id);
  });

</script>
@endsection